//Configuraciones del mapa
mapboxgl.accessToken = "pk.eyJ1Ijoiam1vemFyIiwiYSI6ImNsbXNkaXl6cjBkZWgya21yMmN2YWxlMHcifQ.MqRofl-Zw2eQfn5eTVbw7w";
var map = new mapboxgl.Map({
    container: 'pantalla_mapa',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-77.08555632370167, -12.053057801094083],
    zoom: 18.5
});

var geojson = {
    "type": "FeatureCollection",
    "name": "piso1GJ",
    "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
    "features": [
    { "type": "Feature", "properties": { "id": null, "nombre_area": "100", "codigo": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085593967497502, -12.05345381667043 ], [ -77.085674926537038, -12.053463538039606 ], [ -77.085683684704549, -12.053393781028861 ], [ -77.085602725665012, -12.053384059657162 ], [ -77.085593967497502, -12.05345381667043 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "101" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085512586679741, -12.053444044655627 ], [ -77.085593545719277, -12.053453766024804 ], [ -77.085602303886787, -12.053384009014058 ], [ -77.085521344847251, -12.05337428764236 ], [ -77.085512586679741, -12.053444044655627 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "103" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085350645917572, -12.053424599192423 ], [ -77.085431604957108, -12.0534343205616 ], [ -77.085440363124619, -12.053364563550854 ], [ -77.085359404085082, -12.053354842179155 ], [ -77.085350645917572, -12.053424599192423 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "102" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085432026735333, -12.053434371207226 ], [ -77.085512985774869, -12.053444092576402 ], [ -77.08552174394238, -12.053374335565657 ], [ -77.085440784902843, -12.053364614193958 ], [ -77.085432026735333, -12.053434371207226 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "110" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085270125895136, -12.053414930536343 ], [ -77.085351084934672, -12.053424651905519 ], [ -77.085359843102182, -12.053354894894774 ], [ -77.085278884062646, -12.053345173523075 ], [ -77.085270125895136, -12.053414930536343 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "Capilla" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085302242650187, -12.053229682750477 ], [ -77.085371057202593, -12.053237945838484 ], [ -77.085378501576713, -12.053178652923217 ], [ -77.085309687024278, -12.053170389833065 ], [ -77.085302242650187, -12.053229682750477 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "109" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085608608277894, -12.053337205901105 ], [ -77.085689567317431, -12.053346927270281 ], [ -77.085698325484941, -12.053277170259536 ], [ -77.085617366445405, -12.053267448887837 ], [ -77.085608608277894, -12.053337205901105 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "108" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085527227460133, -12.053327433886302 ], [ -77.08560818649967, -12.053337155255479 ], [ -77.08561694466718, -12.053267398244733 ], [ -77.085535985627644, -12.053257676873034 ], [ -77.085527227460133, -12.053327433886302 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "106" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085365286697964, -12.053307988423098 ], [ -77.085446245737501, -12.053317709792275 ], [ -77.085455003905011, -12.053247952781529 ], [ -77.085374044865475, -12.05323823140983 ], [ -77.085365286697964, -12.053307988423098 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "107" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085446667515725, -12.053317760437901 ], [ -77.085527626555262, -12.053327481807077 ], [ -77.085536384722772, -12.053257724796332 ], [ -77.085455425683236, -12.053248003424633 ], [ -77.085446667515725, -12.053317760437901 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "Lab 8" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085203385857767, -12.053288547752215 ], [ -77.085284344897303, -12.053298269121392 ], [ -77.085293103064814, -12.053228512110646 ], [ -77.085212144025277, -12.053218790738947 ], [ -77.085203385857767, -12.053288547752215 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "105", "codigo": "SA105" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085284461301129, -12.053298319767018 ], [ -77.085365420340665, -12.053308041136194 ], [ -77.085374178508175, -12.053238284125449 ], [ -77.085293219468639, -12.05322856275375 ], [ -77.085284461301129, -12.053298319767018 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "Biblioteca" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085053536314774, -12.053414629415535 ], [ -77.085185495982756, -12.053430474811652 ], [ -77.085215821137751, -12.053188941200045 ], [ -77.085083861469755, -12.053173095789663 ], [ -77.085053536314774, -12.053414629415535 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "><" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085673594784637, -12.053476751579369 ], [ -77.085718175753541, -12.053482104753252 ], [ -77.085714891440716, -12.053508263613258 ], [ -77.085670310471812, -12.053502910439887 ], [ -77.085673594784637, -12.053476751579369 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085717590793152, -12.053487086658162 ], [ -77.085735423180722, -12.053489227927386 ], [ -77.085733233638834, -12.053506667165086 ], [ -77.085715401251264, -12.053504525896006 ], [ -77.085717590793152, -12.053487086658162 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085807355726629, -12.053466551945446 ], [ -77.085838562404888, -12.053470299166861 ], [ -77.085830899008329, -12.053531336498159 ], [ -77.085799692330085, -12.053527589277607 ], [ -77.085807355726629, -12.053466551945446 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "<>" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085816676066557, -12.053290487389138 ], [ -77.085822029240433, -12.053245906420234 ], [ -77.085848188100442, -12.053249190733059 ], [ -77.085842834927078, -12.053293771701963 ], [ -77.085816676066557, -12.053290487389138 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085843051723572, -12.053293546928405 ], [ -77.085837577868887, -12.05333714505233 ], [ -77.085792996899997, -12.053331791876222 ], [ -77.085798470754668, -12.053288193751428 ], [ -77.085843051723572, -12.053293546928405 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085837561654486, -12.053337274192787 ], [ -77.085832087799801, -12.053380872316712 ], [ -77.085787506830911, -12.053375519140603 ], [ -77.085792980685582, -12.053331921015809 ], [ -77.085837561654486, -12.053337274192787 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.08583213925921, -12.053380462427848 ], [ -77.085826665404525, -12.053424060551773 ], [ -77.085782084435635, -12.053418707375664 ], [ -77.085787558290306, -12.053375109250871 ], [ -77.08583213925921, -12.053380462427848 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085826617400784, -12.053424442887632 ], [ -77.085821143546099, -12.053468041011557 ], [ -77.085776562577209, -12.053462687835449 ], [ -77.08578203643188, -12.053419089710655 ], [ -77.085826617400784, -12.053424442887632 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "Baño" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.08587297336814, -12.053251514906327 ], [ -77.085801643817859, -12.053242949821746 ], [ -77.085813686298209, -12.053147033906095 ], [ -77.085885015848461, -12.053155598993735 ], [ -77.08587297336814, -12.053251514906327 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085884996539022, -12.053155246001792 ], [ -77.085813666988784, -12.053146680914146 ], [ -77.085818046072532, -12.053111802390815 ], [ -77.085871543235243, -12.053118226207413 ], [ -77.085873732777102, -12.053100786944469 ], [ -77.085891565164673, -12.053102928216774 ], [ -77.085884996539022, -12.053155246001792 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "106" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.08549283952533, -12.052813411726834 ], [ -77.085573441481088, -12.052825748494323 ], [ -77.085584452962976, -12.052756311520646 ], [ -77.085503851007331, -12.052743974750639 ], [ -77.08549283952533, -12.052813411726834 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "108" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085411817651689, -12.05280101068808 ], [ -77.085492419607448, -12.052813347455574 ], [ -77.085503431089322, -12.052743910481896 ], [ -77.085422829133634, -12.052731573711887 ], [ -77.085411817651689, -12.05280101068808 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "Baño" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085573924595479, -12.052825822457345 ], [ -77.08565452655121, -12.052838159224834 ], [ -77.085665538033041, -12.052768722251161 ], [ -77.085584936077424, -12.05275638548115 ], [ -77.085573924595479, -12.052825822457345 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "-" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085759126009322, -12.052854624404318 ], [ -77.08583972796508, -12.052866961171807 ], [ -77.085850739446968, -12.05279752419813 ], [ -77.085770137491323, -12.052785187428123 ], [ -77.085759126009322, -12.052854624404318 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "102" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085840211079471, -12.052867035134829 ], [ -77.085920813035202, -12.052879371902318 ], [ -77.085931824517033, -12.052809934928645 ], [ -77.085851222561416, -12.052797598158634 ], [ -77.085840211079471, -12.052867035134829 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "103" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085774208462553, -12.052734495529839 ], [ -77.085854810418311, -12.052746832297327 ], [ -77.0858658219002, -12.05267739532365 ], [ -77.085785219944555, -12.052665058553643 ], [ -77.085774208462553, -12.052734495529839 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "101" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085855293532703, -12.052746906260349 ], [ -77.085935895488433, -12.052759243027838 ], [ -77.085946906970264, -12.052689806054165 ], [ -77.085866305014648, -12.052677469284154 ], [ -77.085855293532703, -12.052746906260349 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "107" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085507921978561, -12.052693282852355 ], [ -77.085588523934319, -12.052705619619843 ], [ -77.085599535416208, -12.052636182646166 ], [ -77.085518933460563, -12.052623845876159 ], [ -77.085507921978561, -12.052693282852355 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "109" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.08542690010492, -12.0526808818136 ], [ -77.085507502060679, -12.052693218581094 ], [ -77.085518513542553, -12.052623781607416 ], [ -77.085437911586865, -12.052611444837407 ], [ -77.08542690010492, -12.0526808818136 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "105", "codigo": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085589007048711, -12.052705693582865 ], [ -77.085669609004441, -12.052718030350354 ], [ -77.085680620486272, -12.052648593376681 ], [ -77.085600018530656, -12.05263625660667 ], [ -77.085589007048711, -12.052705693582865 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "<>" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085781040084584, -12.052690837798009 ], [ -77.085736681619863, -12.052683877491685 ], [ -77.08574090885935, -12.052657854365158 ], [ -77.085785267324127, -12.052664814670965 ], [ -77.085781040084584, -12.052690837798009 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "<>" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085433770372205, -12.052637048136825 ], [ -77.085389411907485, -12.052630087830501 ], [ -77.085393639146972, -12.052604064703974 ], [ -77.085437997611749, -12.052611025009782 ], [ -77.085433770372205, -12.052637048136825 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "Auditorio" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085891714776011, -12.053103506233361 ], [ -77.085731223287937, -12.053084234782046 ], [ -77.085753118706734, -12.052909842079485 ], [ -77.085913610194808, -12.052929113543325 ], [ -77.085891714776011, -12.053103506233361 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "Cancha", "codigo": "AR001" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085226988978675, -12.052972638785345 ], [ -77.085358948646657, -12.052988484181462 ], [ -77.085389273801653, -12.052746950569855 ], [ -77.085257314133656, -12.052731105159474 ], [ -77.085226988978675, -12.052972638785345 ] ] ] ] } },
    { "type": "Feature", "properties": { "id": null, "nombre_area": "GYM" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -77.085115353512307, -12.053176823080392 ], [ -77.085184168064714, -12.0531850861684 ], [ -77.085191612438834, -12.053125793253132 ], [ -77.085122797886399, -12.05311753016298 ], [ -77.085115353512307, -12.053176823080392 ] ] ] ] } }
    ]
    }
    
    
    


map.on('load', () => {
    // Add a data source containing GeoJSON data.
    map.addSource('maine', {
        'type': 'geojson',
        'data': geojson
        
    }
    
    
    );
    

            // Add a new layer to visualize the polygon.
            map.addLayer({
                'id': 'maine',
                'type': 'fill',
                'source': 'maine', // reference the data source
                'layout': {},
                'paint': {
                    'fill-color': [
                        'match',
                        ['get','tipo'],
                        'otro','red',
                        'salon','blue',
                        'white'
    
                    ], // colores por tipos
                    'fill-opacity': 0.9
                }
            });
        // Add a black outline around the polygon.
        map.addLayer({
            'id': 'outline',
            'type': 'line',
            'source': 'maine',
            'layout': {},
            'paint': {
                'line-color': '#000',
                'line-width': 2
            }
        });

        map.addLayer({
            'id': 'poi-labels',
            'type': 'symbol',
            'source': 'maine',
            'layout': {
            'text-field': ['get', 'nombre_area'],
            'text-radial-offset': 0.0,
            'text-size': 10,
            'text-justify': 'auto',
            'icon-image': ['get', 'icon']
            }
            });

        
    });

    function mostrar(code)
    { 
      var parametros = 
      {
        "codigo" : code,
        "apellido" : "hurtado",
        "telefono" : "123456789"
      };

      $.ajax({
        data: parametros,
        url: '../controlador/controlador_ajax_area.php',
        type: 'POST',
        
        beforesend: function()
        {
          $('#mostrar_mensaje').html("Mensaje antes de Enviar");
        },

        success: function(mensaje)
        {
          $('#mostrar_datos').html(mensaje);
        }
      });
    }

    //Eventos

    map.on('click', 'maine',function(e) {
        // Tu código a ejecutar cuando se hace clic en el marcador
        var codigo = e.features[0].properties.codigo;

    // Comprueba si el codigo es igual a "salon".
   
        //alert('Marcador clickeado'+codigo);
        if(codigo!=null){
            mostrar(codigo);
            mostrar_info();
        }
        
        
        
        //document.getElementById("ventanaEmergente").style.display = "block";

        //const botonCerrar = document.getElementById("cerrarVentana");
    
        //botonCerrar.addEventListener("click", function () {
        //    ventanaEmergente.style.display = "none";
        //});
    });